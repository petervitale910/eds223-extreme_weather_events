---
title: "Extreme weather events"
author: 'Peter Vitale'
date: '10/26/25'
format: html
editor: visual
execute: 
  cache: true
  warning: false
  message: false
---

In this project we will examine environmental effects of Texas storms:

-   

-   

-   

I'm going to start by loading in the neccesary packages

```{r}
pacman::p_load('tidyverse', 
               'sf', 
               'here', 
               'tmap', 
               'kableExtra',
               'patchwork',
               'ggthemes',
               'stars',
               'terra')
```

### Data Aggregation

Read in the light data

```{r}
lights_07_1 <- read_stars(here::here('data', 'VNP46A1', 'VNP46A1.A2021038.h08v05.001.2021039064328.tif'))
lights_07_2 <-  read_stars(here::here('data', 'VNP46A1', 'VNP46A1.A2021038.h08v06.001.2021039064329.tif'))
lights_16_1 <- read_stars(here::here('data', 'VNP46A1', 'VNP46A1.A2021047.h08v05.001.2021048091106.tif'))
lights_16_2 <- read_stars(here::here('data', 'VNP46A1', 'VNP46A1.A2021047.h08v06.001.2021048091105.tif'))

```

Read in the buildings & roads

```{r}
houses <- st_read(here::here('data', 'gis_osm_buildings_a_free_1.gpkg'),
                 query = "
    SELECT * FROM gis_osm_buildings_a_free_1
    WHERE (type IS NULL AND name IS NULL)
       OR type IN ('residential', 'apartments', 'house', 'static_caravan', 'detached')", 
    quiet = TRUE)
```

Road data
```{r}
roads <- st_read(here::here('data', 'gis_osm_roads_free_1.gpkg'),
                 query = "SELECT * FROM gis_osm_roads_free_1 WHERE fclass='motorway'",
                 quiet = TRUE)
```


Socioeconomic layers
```{r}
st_layers(here::here('data', 'ACS_2019_5YR_TRACT_48_TEXAS.gdb'))

income <- st_read(here::here('data', 'ACS_2019_5YR_TRACT_48_TEXAS.gdb'),
                  layer = 'X19_INCOME', quiet = TRUE) %>% 
  select(c('GEOID', 'B19013e1', 'B19013m1'))

census <- st_read(here::here('data', 'ACS_2019_5YR_TRACT_48_TEXAS.gdb'),
                  layer = 'ACS_2019_5YR_TRACT_48_TEXAS', quiet = TRUE)
```

# Blackout mask 

```{r}

lights_7 <- st_mosaic(lights_07_1, lights_07_2)

lights_16 <- st_mosaic(lights_16_1, lights_16_2)

huston_change <- lights_16 - lights_7

# Reclassify: 
# Set categories for severity levels
categories <- c("No Blackout", "Unburned")

# Create reclassification matrix
rcl <- matrix(c(-Inf, 200, 1, # group 1 ranges for Enhanced Regrowth
                200, Inf, 2), # group 5 ranges for High Severity
                ncol = 3, byrow = TRUE)

# Use reclassification matrix to reclassify dNBR raster
reclassified <- classify(rast(huston_change), rcl = rcl)

reclassified[is.nan(reclassified)] <- NA

blackout_mask <- st_as_sf(as.polygons(reclassified))

```
```{r}



```

